<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel kadr</title>
  <style>
    body { font-family: Arial, sans-serif; background: #f9f9f9; padding: 20px; }
    h1, h2 { color: #333; }
    table { border-collapse: collapse; width: 100%; margin-top: 20px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
    button { margin-top: 10px; padding: 5px 10px; }
    .hidden { display: none; }
    .flex-row { display: flex; gap: 10px; }
    .card { background: #fff; padding: 20px; border-radius: 8px; box-shadow: 0 0 10px rgba(0,0,0,0.1); }
  </style>
</head>
<body>
  <h1>Panel kadr</h1>
  <div id="adminPanel" class="hidden">
    <div class="flex-row">
      <button onclick="pokazWidok('lista')">Lista pracowników</button>
      <button onclick="pokazWidok('wnioski')">Wnioski urlopowe</button>
    </div>

    <div id="lista" class="card hidden">
      <h2>Lista pracowników</h2>
      <input type="text" id="imieNazwisko" placeholder="Imię i nazwisko">
      <input type="number" id="dniUrlopu" placeholder="Dni urlopu (domyślnie 20)">
      <select id="menedzerSelect">
        <option value="ppisarczyk">Pisarczyk Paweł</option>
        <option value="hwroblewski">Wróblewski Hubert</option>
        <option value="dnowikow">Nowikow Dariusz</option>
        <option value="dszmulik">Szmulik Damian</option>
        <option value="pnurzynski">Nurzyński Paweł</option>
        <option value="edusinska">Ewa Dusińska</option>
      </select>
      <button onclick="dodajPracownika()">Dodaj pracownika</button>
      <table>
        <thead><tr><th>Imię i nazwisko</th><th>Dni urlopu</th><th>Menedżer</th><th>Usuń</th></tr></thead>
        <tbody id="tabelaPracownikow"></tbody>
      </table>
    </div>

    <div id="wnioski" class="card hidden">
      <h2>Wnioski urlopowe</h2>
      <table>
        <thead><tr><th>Pracownik</th><th>Od</th><th>Do</th><th>Ilość dni</th><th>Status</th><th>Akcja</th></tr></thead>
        <tbody id="tabelaWnioskow"></tbody>
      </table>
    </div>
  </div>

  <div id="menedzerPanel" class="hidden">
    <h2>Twoi pracownicy - wnioski</h2>
    <table>
      <thead><tr><th>Pracownik</th><th>Od</th><th>Do</th><th>Ilość dni</th><th>Status</th><th>Akcja</th></tr></thead>
      <tbody id="tabelaWnioskowMenedzera"></tbody>
    </table>
  </div>

  <script>
    const przypisania = JSON.parse(localStorage.getItem("pracownicy")) || [];
    const wnioski = JSON.parse(localStorage.getItem("wnioski")) || [];
    const rola = sessionStorage.getItem("rola");
    const login = sessionStorage.getItem("login");

    function pokazWidok(id) {
      document.getElementById("lista").classList.add("hidden");
      document.getElementById("wnioski").classList.add("hidden");
      document.getElementById(id).classList.remove("hidden");
      if (id === "lista") wypelnijListe();
      if (id === "wnioski") wypelnijWnioski();
    }

    function dodajPracownika() {
      const imieNazwisko = document.getElementById("imieNazwisko").value;
      const dni = parseInt(document.getElementById("dniUrlopu").value) || 20;
      const menedzer = document.getElementById("menedzerSelect").value;
      przypisania.push({ imie: imieNazwisko, dni, menedzer });
      localStorage.setItem("pracownicy", JSON.stringify(przypisania));
      wypelnijListe();
    }

    function usunPracownika(index) {
      przypisania.splice(index, 1);
      localStorage.setItem("pracownicy", JSON.stringify(przypisania));
      wypelnijListe();
    }

    function wypelnijListe() {
      const tbody = document.getElementById("tabelaPracownikow");
      tbody.innerHTML = "";
      przypisania.forEach((p, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${p.imie}</td><td>${p.dni}</td><td>${p.menedzer}</td><td><button onclick="usunPracownika(${i})">Usuń</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function wypelnijWnioski() {
      const tbody = document.getElementById("tabelaWnioskow");
      tbody.innerHTML = "";
      wnioski.forEach((w, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${w.pracownik}</td><td>${w.od}</td><td>${w.do}</td><td>${w.dni}</td><td>${w.status}</td><td>
        <button onclick="zmienStatus(${i}, 'zaakceptowany')">Akceptuj</button>
        <button onclick="zmienStatus(${i}, 'odrzucony')">Odrzuć</button>
        </td>`;
        tbody.appendChild(tr);
      });
    }

    function zmienStatus(i, status) {
      wnioski[i].status = status;
      localStorage.setItem("wnioski", JSON.stringify(wnioski));
      wypelnijWnioski();
      wypelnijWnioskiMenedzera();
    }

    function wypelnijWnioskiMenedzera() {
      const tbody = document.getElementById("tabelaWnioskowMenedzera");
      tbody.innerHTML = "";
      const pracownicy = przypisania.filter(p => p.menedzer === login).map(p => p.imie);
      const widoczne = wnioski.filter(w => pracownicy.includes(w.pracownik));
      widoczne.forEach((w, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${w.pracownik}</td><td>${w.od}</td><td>${w.do}</td><td>${w.dni}</td><td>${w.status}</td><td>
        <button onclick="zmienStatus(${i}, 'zaakceptowany')">Akceptuj</button>
        <button onclick="zmienStatus(${i}, 'odrzucony')">Odrzuć</button>
        </td>`;
        tbody.appendChild(tr);
      });
    }

    if (rola === "admin") {
      document.getElementById("adminPanel").classList.remove("hidden");
      pokazWidok("lista");
    } else if (rola === "menedzer") {
      document.getElementById("menedzerPanel").classList.remove("hidden");
      wypelnijWnioskiMenedzera();
    } else {
      alert("Brak dostępu. Zaloguj się jako admin lub menedżer.");
      window.location.href = "kadry_login.html";
    }
  </script>
</body>
</html>
