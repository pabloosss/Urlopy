<!DOCTYPE html>
<html lang="pl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Panel Kadrowy</title>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; background: #f8f9fa; }
    h2 { margin-top: 40px; }
    table, th, td { border: 1px solid #ccc; border-collapse: collapse; padding: 8px; }
    table { width: 100%; margin-top: 10px; }
    input, select, button { margin: 5px 0; padding: 6px; }
    .hidden { display: none; }
  </style>
</head>
<body>
  <h1>Panel Kadrowy</h1>

  <div id="admin-panel" class="hidden">
    <h2>Dodaj pracownika</h2>
    <input type="text" id="imieNazwisko" placeholder="Imię i nazwisko" />
    <select id="przelozony">
      <option value="">Wybierz menedżera</option>
    </select>
    <button onclick="dodajPracownika()">Dodaj pracownika</button>

    <h2>Lista pracowników</h2>
    <table id="tabelaPracownikow">
      <thead>
        <tr><th>Imię i nazwisko</th><th>Menedżer</th><th>Dni urlopowe</th><th>Akcje</th></tr>
      </thead>
      <tbody></tbody>
    </table>

    <h2>Dodani menedżerowie</h2>
    <table>
      <thead><tr><th>Imię i nazwisko</th><th>Login</th><th>Hasło</th></tr></thead>
      <tbody id="tabelaMenedzerow"></tbody>
    </table>
  </div>

  <div id="wnioski-panel" class="hidden">
    <h2>Wnioski urlopowe</h2>
    <table id="tabelaWnioskow">
      <thead><tr><th>Pracownik</th><th>Od</th><th>Do</th><th>Liczba dni</th><th>Status</th><th>Akcja</th></tr></thead>
      <tbody></tbody>
    </table>
  </div>

  <script>
    const MENEDZEROWIE_STALI = [
      { imie: "Pisarczyk Paweł", login: "ppisarczyk", haslo: "haslo111" },
      { imie: "Wróblewski Hubert", login: "hwroblewski", haslo: "haslo112" },
      { imie: "Nowikow Dariusz", login: "dnowikow", haslo: "haslo113" },
      { imie: "Szmulik Damian", login: "dszmulik", haslo: "haslo114" },
      { imie: "Nurzyński Paweł", login: "pnurzynski", haslo: "haslo115" },
      { imie: "Ewa Dusińska", login: "edusinska", haslo: "haslo116" }
    ];

    let pracownicy = JSON.parse(localStorage.getItem("pracownicy")) || [];
    let wnioski = JSON.parse(localStorage.getItem("wnioski")) || [];
    const rola = sessionStorage.getItem("rola");
    const login = sessionStorage.getItem("login");

    function zapisz() {
      localStorage.setItem("pracownicy", JSON.stringify(pracownicy));
      localStorage.setItem("wnioski", JSON.stringify(wnioski));
    }

    function init() {
      if (rola === "admin") {
        document.getElementById("admin-panel").classList.remove("hidden");
        document.getElementById("wnioski-panel").classList.remove("hidden");
        wypelnijPracownikow();
        wypelnijMenedzerow();
        wypelnijSelectMenedzerow();
        wypelnijWnioski();
      } else if (rola === "menedzer") {
        document.getElementById("wnioski-panel").classList.remove("hidden");
        wypelnijWnioski();
      } else {
        alert("Brak dostępu. Zaloguj się jako menedżer lub administrator.");
        window.location.href = "kadry_login.html";
      }
    }

    function wypelnijMenedzerow() {
      const tbody = document.getElementById("tabelaMenedzerow");
      tbody.innerHTML = "";
      MENEDZEROWIE_STALI.forEach(m => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${m.imie}</td><td>${m.login}</td><td>${m.haslo}</td>`;
        tbody.appendChild(tr);
      });
    }

    function wypelnijSelectMenedzerow() {
      const select = document.getElementById("przelozony");
      MENEDZEROWIE_STALI.forEach(m => {
        const option = document.createElement("option");
        option.value = m.login;
        option.textContent = m.imie;
        select.appendChild(option);
      });
    }

    function wypelnijPracownikow() {
      const tbody = document.querySelector("#tabelaPracownikow tbody");
      tbody.innerHTML = "";
      pracownicy.forEach((p, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${p.nazwisko}</td><td>${p.menedzer}</td><td>${p.dni || 20}</td><td><button onclick="usunPracownika(${i})">Usuń</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function wypelnijWnioski() {
      const tbody = document.querySelector("#tabelaWnioskow tbody");
      tbody.innerHTML = "";
      const widoczneWnioski = rola === "admin" ? wnioski : wnioski.filter(w => {
        const p = pracownicy.find(p => p.nazwisko === w.pracownik);
        return p && p.menedzer === login;
      });
      widoczneWnioski.forEach((w, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${w.pracownik}</td><td>${w.od}</td><td>${w.do}</td><td>${w.ile}</td><td>${w.status}</td><td>
        <button onclick="akceptujWniosek(${i})">Akceptuj</button>
        <button onclick="odrzucWniosek(${i})">Odrzuć</button></td>`;
        tbody.appendChild(tr);
      });
    }

    function dodajPracownika() {
      const nazwisko = document.getElementById("imieNazwisko").value;
      const menedzer = document.getElementById("przelozony").value;
      if (!nazwisko || !menedzer) return alert("Wypełnij wszystkie pola");
      pracownicy.push({ nazwisko, menedzer, dni: 20 });
      zapisz();
      wypelnijPracownikow();
      alert("Dodano pracownika");
    }

    function usunPracownika(i) {
      if (confirm("Na pewno chcesz usunąć pracownika?")) {
        pracownicy.splice(i, 1);
        zapisz();
        wypelnijPracownikow();
      }
    }

    function akceptujWniosek(i) {
      wnioski[i].status = "✅ zaakceptowany";
      zapisz();
      wypelnijWnioski();
    }

    function odrzucWniosek(i) {
      wnioski[i].status = "❌ odrzucony";
      zapisz();
      wypelnijWnioski();
    }

    window.onload = init;
  </script>
</body>
</html>
